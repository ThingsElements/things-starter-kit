<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="things-oi-import.html">

<dom-module id="things-oi-app">
  <template>
    <style include="shared-styles">
      @import "theme.css";
    </style>

    <style is="custom-style">
      app-drawer {
        --app-drawer-content-container: {
        background-color: #B0BEC5;
        @apply(--layout-vertical);
        };
        --app-drawer-width : 170px;
      }
      .user-menu {
        background-color:rgba(0,0,0,.3);
        padding:5px;
      }
      app-header-layout {
        @apply(--layout-fullbleed);
        @apply(--layout-vertical);
      }
      app-header-layout::shadow #contentContainer {
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      #scrollingRegion {
        overflow-y: auto;
        /* fixes scroll track's z-index bug in safari*/
        -webkit-transform: translateZ(0);
        @apply(--layout-flex);
        @apply(--layout-vertical);
        padding:15px;
      }
      things-sidebar {
        @apply(--layout-flex);
        --things-sidebar-panel: {
          @apply(--layout-flex);
        }
      }
      iron-pages {
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      things-logout::shadow paper-icon-button {
        @apply(--things-small-icon);
        float:right;
        top:1px;left:37px;
      }
      app-toolbar {
        @apply(--things-oi-header);
      }
      app-toolbar #fullscreen-btn,app-toolbar #infoBtn{
        @apply(--things-header-button);
        color:#41d0ff;
      }
      app-toolbar #fullscreen-btn{
        background:url(/images/icon-fullscreen.png) 50% 50% no-repeat;
      }
      app-toolbar #fullscreen-btn:focus,app-toolbar #infoBtn:focus{
        outline:none
      }
      paper-toolbar{
        @apply(--things-oi-search-form);
        height:initial;
      }
      paper-toolbar::shadow #topBar{
        padding:0;
        height:initial;
      }
      paper-toolbar .title {
        margin-left:32px !important;
        line-height:initial !important;
      }
      things-date-picker::shadow paper-icon-button.things-date-picker{
        background-position:55% -94px;
      }
      things-code-combo::shadow iron-icon.things-combo {
        background-position:54% -43px;
      }
      things-resource-selector::shadow iron-icon.things-resource-selector {
        background-position:54% 6px;
      }
      #vertical-div {
        @apply(--layout-vertical);
      }
      things-sidebar::shadow .brand{
        background:url(/images/icon-brand.png) no-repeat #1D4667;
      }
      things-profile{
        background-color:transparent;
      }
      paper-toolbar things-date-picker,paper-toolbar things-code-combo,paper-toolbar things-resource-selector{
        width:47%;
        float:left;
      }
      .orderinfo{
        flex-1;
        width:20%;
      }
      .routinginfo{
        flex-4;
        width:80%;
      }
      span.subtitle{
        @apply(--things-subtitle);
      }
      span.subtitle:before{
        @apply(--things-subtitle-icon);
      }
      things-wip-routing-detail::shadow things-wip-routing-detail-scrollable{
        width:100%;
      }
    </style>

    <!-- form validators -->
    <things-validators id="validators"></things-validators>
    <!-- date picker dialog -->
    <things-date-picker-dialog id="date-picker-dialog"></things-date-picker-dialog>
    <!-- things event mananger -->
    <things-event-manager 
      events = '[{"name": "success","function":"showToastInfo"},
                {"name": "failure","function" : "showToastConfim"}]'>
    </things-event-manager>
    <!-- local storage -->
    <iron-localstorage 
      id="localStorage" 
      name="{$ appName $}" 
      value="{{storage}}" 
      on-iron-localstorage-load-empty="initializeDefaultStorage">
    </iron-localstorage>
        
    <!-- OI Layout -->
    <app-drawer-layout responsive-width="{$ responsiveWidth $}">
      <app-drawer swipe-open>
        <things-sidebar
          id ="sidebar"
          menu-category ="TERMINAL"
          drawer-id='paperDrawerPanel' 
          page-content-id='content'
          class="layout vertical" 
          title="Elidom" 
          screens="{{screens}}" 
          resource-screens="{{resourceScreens}}"
          diy-screens="{{diyScreens}}"
          selected-menu ="{{selectedMenu}}"
          resource-url="menus.json?mode=auth"
          resource-action="index">
          <div class="user-menu header">
            <!-- sidebar header toolbar menu start-->
            <things-profile></things-profile>
            <!-- oi entrance -->
            <things-oi-entrance></things-oi-entrance>
            <!-- setting -->
            <things-setting></things-setting>
            <!-- logout -->
            <things-logout id="logout" action="logout" icon="icons:power-settings-new"></things-logout>
            <!-- sidebar header toolbar menu end -->
          </div>
        </things-sidebar>
      </app-drawer>

      <app-header-layout id="contentArea">
        <app-header>
          <app-toolbar>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            
            <span title class="title">[[selectedMenu.pageName]]</span>
            <!-- <div title></div> -->
            <button id="fullscreen-btn" on-tap="_fullScreenTap"></button>
            <paper-tooltip for="fullscreen-btn" offset="0">
              <things-i18n-msg msgid="button.fullscreen">Full Screen</things-i18n-msg>
            </paper-tooltip>
            <paper-icon-button id="infoBtn" icon="icons:error-outline" onclick="document.getElementById('informationContainer').toggle()"></paper-icon-button>
          </app-toolbar>
          <paper-toolbar>
            <form is="iron-form" id="header-form" method="post" action="/form/handler">
              <things-date-picker
                id="date-picker"
                label="Date"
                value="{{globals.date}}">
              </things-date-picker>
              <iron-localstorage name="OI.date" value="{{globals.date}}">
              </iron-localstorage>

              <things-code-combo
                id="line-selector" 
                label="Line" 
                code-name="LINE"
                value="{{globals.line}}"
                label-path="description" 
                value-path="name">
              </things-code-combo>
              <iron-localstorage name="OI.line" value="{{globals.line}}">
              </iron-localstorage>

              <things-resource-selector 
                id="resource-selector" 
                label="Operation" 
                name="operation"
                obj-value="{{globals.operation}}"
                resource-type="Entity"
                resource-name="Operation"
                resource-title-field="name">
              </things-resource-selector>
              <iron-localstorage name="OI.operation" value="{{globals.operation}}">
              </iron-localstorage>

              <things-resource-selector 
                id="resource-selector" 
                label="Order" 
                name="order"
                obj-value="{{globals.order}}"
                resource-type="Menu"
                resource-name="WorkOrder"
                resource-title-field="name">
              </things-resource-selector>
              <iron-localstorage name="OI.order" value="{{globals.order}}">
              </iron-localstorage>
            </form>
          </paper-toolbar>
        </app-header>

        <div id="scrollingRegion">
          <iron-collapse id ="informationContainer" opened class="layout horizontal">
            <div class="orderinfo">
              <span class="subtitle">order informatin</span>
              <things-wip-order-info order="[[globals.wip.order]]"></things-wip-order-info>
            </div>

            <div class="routinginfo">
              <span class="subtitle">routing information</span>
              <!-- {{globals.order.product_model.routing_id}}" -->
              <things-wip-routing-detail
                id="wip"
                search-url ="work_orders/:id/wip"
                resource-id ="{{globals.order.id}}"
                class="layout vertical flex"
                show-info="true">
              </things-wip-routing-detail>
            </div>
          </iron-collapse>

          <iron-pages attr-for-selected="data-route" selected="{{route}}" id="content">
            <div class ="layout flex"></div>
          </iron-pages>
        </div>        
      </app-header-layout>
    
    </app-drawer-layout>
    
    <!-- full dialog -->
    <things-full-dialog id='common-full-dialog'></things-full-dialog>
    <!-- resource dialog -->
    <things-resource-dialog id='resource-dialog'></things-resource-dialog>
    <!-- confirm toast -->
    <paper-toast id="confirmToast" class="Toast" duration="8000">
      <span class="Toast-button" role="button" tabindex="0" on-tap="onConfirmToastTap">OK</span>
    </paper-toast>
    <!-- info toast -->
    <paper-toast id="infoToast" class="Toast" duration="1000"></paper-toast>
  </template>
    
  <script src="things-oi-app.js"></script>
</dom-module>