<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/things-i18n-msg/things-i18n-msg.html">
<link rel="import" href="../../bower_components/things-ajax/things-ajax.html">

<dom-module id="things-label-card">
	<template>
		<style>
			:host{
				display: block;
				background-color:var(--things-whitegrey-background-color);
			}
      paper-toolbar{
        background-color:var(--things-primary-background-color);
	      height:45px;
	      margin-top:0px !important;
	      @apply(--things-padding-clear)
      }
      paper-toolbar::shadow #topBar{
        height:45px;
      }
      paper-toolbar::shadow #bottomBar {
        height: 45px;
        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
        padding: 0 10px;
      }      
      paper-toolbar .title{
        margin-left:32px !important;
        line-height:initial !important;
      }
      form{
        @apply(--things-default-padding);
        padding-bottom:5px;
        border-bottom:1px solid rgba(0,0,0,.1);
      }
      paper-fab{
        @apply(--things-search-fab);
      }
      #fullscreen-btn{
        @apply(--things-header-button);
        background:url(/images/icon-fullscreen.png) 100% 50% no-repeat;
      }      
			paper-card{
        @apply(--things-label-card-container)
      }
      paper-card:last-child{margin-right:0;}
      paper-card::shadow iron-image img{height:105px !important;}
      paper-card .card-info{
        padding:0 7px 7px 7px;
        font-size:11px;
        color:green;
      }
      paper-card::shadow .title-text{
        position:relative !important;
        border-top:1px dotted rgba(0,0,0,.09);
        padding:5px 7px 0 7px !important;
        font-size:14px !important
      }
			@media only all and (min-width: 400px)  {paper-card{width:  98% !important;}}
      @media only all and (min-width: 500px)  {paper-card{width:  47% !important;}}
      @media only all and (min-width: 800px)  {paper-card{width:  30% !important;}}
      @media only all and (min-width: 900px)  {paper-card{width:30.5% !important;}}
      @media only all and (min-width:1250px)  {paper-card{width:22.6% !important;}}
      @media only all and (min-width:1800px)  {paper-card{width:17.5% !important;}}
      @media only all and (min-width:2150px)  {paper-card{width:14.4% !important;}}
      .detail-card {
      	@apply(--layout-horizontal);
      }
      .detail-content {
      	@apply(--layout-vertical);
      }
	    .close-btn{
	      @apply(--things-header-button);
	      background:url(/images/icon-close.png) 100% 50% no-repeat;
	      margin-right:10px;
	    }
		</style>

    <paper-toolbar>
      <span class="title">[[menuInfo.title]]</span>
      <button id="fullscreen-btn" on-tap="toggleFullscreen">
      </button>
      <paper-tooltip for="fullscreen-btn" offset="0">
        <things-i18n-msg msgid="button.fullscreen">Full Screen</things-i18n-msg>
      </paper-tooltip>
    </paper-toolbar>

		<things-ajax
			auto
      id="label-search"
      method="GET"
      resource-url="[[searchUrl]]"
      last-response="{{lastResponse}}">
		</things-ajax>

		<template is="dom-repeat" items="[[lastResponse]]">
			<paper-card
		    heading="[[item.name]]"
		    image="[[item.thumbnail]]"
		    animated="[[animated]]"
		    animated-shadow="[[animatedShadow]]"
		    preload-image="[[preloadImage]]"
		    fade-image="[[fadeImage]]"
		    elevation="[[elevation]]"
		    on-tap="itemTaped">
		    <div class="card-info">
        	[[item.description]]
        </div>
			</paper-card>
		</template>

		<paper-dialog
			id="dialog"
			entry-animation="scale-up-animation"
			exit-animation="fade-out-animation"
			modal>
      <paper-toolbar>
        <span class="title">[[singleItem.name]]</span>
        <div class="buttonsGroup">
          <button dialog-dismiss class="close-btn"></button>
        </div>
      </paper-toolbar>
	  	<div class="detail-card">
	  		<iron-image src="[[singleItem.thumbnail]]" width="450" height="450" sizing="contain"></iron-image>
	  		<div class="detail-content">
		  		<things-input-field label="Status" value="[[singleItem.status]]" readonly></things-input-field>
		  		<things-input-field label="Version" value="[[singleItem.version]]" readonly></things-input-field>
		  		<things-input-field label="Description" value="[[singleItem.description]]" readonly></things-input-field>
		  		<things-input-field label="Tags" value="[[singleItem.tags]]" readonly></things-input-field>
		  		<things-input-field label="Width" value="[[singleItem.width]]" readonly></things-input-field>
		  		<things-input-field label="Height" value="[[singleItem.height]]" readonly></things-input-field>
		  		<things-input-field label="Updater" value="[[singleItem.updater.name]]" readonly></things-input-field>
		  		<things-input-field label="Updated At" value="[[singleItem.updated_at]]" readonly></things-input-field>
	  		</div>
  		</div>

			<paper-toolbar>
				<div class="bottom">
					<things-button-bar id="button-bar" buttons="[[buttons]]"></things-button-bar>
				</div>
			</paper-toolbar>

		</paper-dialog>

	</template>

	<script>
		Polymer({
			is: 'things-label-card',

			behaviors: [
				Things.ViewOpenBehavior
			],

			properties: {
				
				menuInfo:  {
					type: Object
				},

				/**
				 * Ajax 호출 URL
				 */
				searchUrl: {
					type: String,
					value: '/labels'
				},

				card: {
					type: Object
				},

				/**
				 * Read-only property used to pass down the animatedShadow value to the underlying paper-material style (since they have different names).
				 */
				animated: {
					type: Boolean,
					value: false
				},

				/**
				 * Set this to true to animate the card shadow when setting a new z value.
				 */
				animatedShadow: {
					type: Boolean,
					value: false
				},

				/**
				 * When preloadImage is true, setting fadeImage to true will cause the image to fade into place.
				 */
				fadeImage: {
					type: Boolean,
					value: false
				},

				/**
				 * When true, any change to the image url property will cause the placeholder image to be shown until the image is fully rendered.
				 */
				preloadImage: {
					type: Boolean,
					value: false
				},

				/**
				 * The z-depth of the card, from 0-5.
				 */
				elevation: {
					type: Number
				},

				singleItem: {
					type: Object
				},

				/**
				 * 버튼 종류
				 */
				buttons: {
					type: Array,
          value: [ {
            id: 'print-btn',
            text: 'print'
          } ]
				}
			},

			listeners: {
				'button-bar.print-btn-tap': '_printLabel'
			},

			/**
			 * item 클릭시 발생하는 이벤트
			 * 클릭한 아이템의 meta 정보를 초기화 하고 dialog를 오픈 합니다.
			 */
			itemTaped: function(e) {
				this.singleItem = e.model.item;
				this.$['dialog'].open();
			},

			/**
			 * Print button 클릭시 발생하는 프린트 기능
			 */
			_printLabel: function(e) {
				console.log(e);
				console.log("TODO: inserting print logic");
			}
		});
	</script>
</dom-module>