<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<dom-module id="things-recent-page">
	<template>
		<div>
			<template is="dom-repeat" items="[[recentPages]]">		
	  		<paper-item>
	  			<li>
		  			<paper-item-body on-tap="routing">[[item.pageName]]</paper-item-body>
	  				<paper-icon-button icon="icons:clear" on-tap="deleteItem"></paper-icon-button>
  				</li>
				</paper-item>
	  	</template>
	  </div>

  	<iron-localstorage
  		id="local-storage"
  		name="recentPages"
  		value="{{recentPages}}">
  	</iron-localstorage>
	</template>

	<script>
		Polymer({
			is: 'things-recent-page',

			properties: {

				/**
				 * local storage에 저장되는 최근 방문 페이지의 
				 * pageName과 routeInfo
				 */
				recentPages: {
					type: Object
				},

				/**
				 * local storage의 저장 가능한 목록수
				 */
				maxCount: {
					type: Number,
					value: 10
				},

				/**
				 * 새로 추가될 pageName, routeInfo
				 */
				items: {
					type: Object,
					observer: '_itemsChanged'
				}
			},

			/**
			 * items가 변화하면 실행되는 function
			 * 새로 추가된 pageName, routeInfo를 첫번째 index에 추가하고 index값이 maxCount를 넘어서는 것은 삭제 
			 */
			_itemsChanged: function() {
				if(!this.recentPages) {
					this.recentPages = [];
				}
				this.unshift('recentPages', this.items);

				while(this.recentPages.length > this.maxCount) {
					this.splice('recentPages', -1, 1);
				}
			},

			/**
			 * 삭제 버튼 클릭시 실행되며 해당 item의 index를 통해 해당 index의 item을 local storage에서 삭제
			 */
			deleteItem: function(event) {
				var idx = event.model.index;
				this.splice('recentPages', idx, 1);
			},

			/**
			 * 화면에 출력된 pageName 클릭시 해당 페이지로 이동
			 */
			routing: function(event) {
				var item = event.model.item;

				page(item.routeInfo);
			}		
		});
	</script>
</dom-module>